#!/bin/bash

usage="Usage: ${0##*/} [up|down]"

http_proxy="http://127.0.0.1:1081"
https_proxy="http://127.0.0.1:1081"

check_connection() {
    if ! ping -c 1 www.baidu.com > /dev/null 2>&1; then
        echo "Error: Network is not connected."
        exit 1
    fi
}

set_proxy() {
    echo "Setting proxy to $http_proxy"
    export http_proxy="$http_proxy"
    export https_proxy="$https_proxy"
}

unset_proxy() {
    echo "Unsetting proxy"
    unset http_proxy
    unset https_proxy
}

case "$1" in
    up)
        check_connection
        set_proxy
        ;;
    down)
        unset_proxy
        ;;
    *)
        echo "$usage"
        exit 1
        ;;
esac

exit 0
